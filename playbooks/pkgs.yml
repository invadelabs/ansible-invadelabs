---
  - name: debconf; postfix; option type 'Internet with smarthost'
    debconf: name=postfix question="postfix/main_mailer_type" value="'Internet with smarthost'" vtype="string"

  - name: debconf; postfix; option type 'System mail name'
    debconf: name=postifx question="postfix/mailname" value="invadelabs.com" vtype="string"

  - name: install packages
    apt: name={{item}} state=latest # update_cache=yes
    with_items:
    - mailutils
    - postfix
    - libsasl2-modules # needed for postfix sendgrid

    - apache2
    - libapache2-mod-php7.0
    - php7.0-sqlite3
    - php7.0-mbstring
    - php7.0-xml
    - php-curl
    - libsasl2-modules
    - php-apcu

    - certbot
    - python-certbot-apache

    - highlight # for invadelabs/cron-invadelabs
    - lynis # for invadelabs/cron-invadelabs/check_lynis.sh
    - snapd # for invadelabs/cron-invadelabs/gdrive.sh
    - bc # for invadelabs/cron-invadelabs/wiki_to_md.sh
    - pandoc # for invadelabs/cron-invadelabs/wiki_to_md.sh
    - pxz # for invadelabs/cron-invadelabs/gdrive.sh
    - gawk # for lynis and ansi2html
    - dbus # for lynis and ansi2html
    notify:
    - Start apache2.service
    - Start postfix.service

  - name: etckeeper post-install
    command: touch /var/log/firstpkg.run && etckeeper post-install
    args:
      creates: /var/log/firstpkg.run
